(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{419:function(s,a,t){"use strict";t.r(a);var n=t(21),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"企业中的-dns-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#企业中的-dns-服务"}},[s._v("#")]),s._v(" 企业中的 DNS 服务")]),s._v(" "),t("p",[s._v("常规做法:购买域名,完成 ICP 备案,并使用公网 DNS 服务(万网,新网等)进行免费解析")]),s._v(" "),t("ul",[t("li",[s._v("内网 web 服务:jira,wiki,zabbix,jenkins 等,不适合解析至公网")]),s._v(" "),t("li",[s._v("服务器都有 hostname,hostname 应该设置为 FQDN,如何维护主机名和主机的内网 IP 的关系")]),s._v(" "),t("li",[s._v("一些中间件的服务(mysql,mq,redis)等,由于会经常迁移和括缩容,应该使用域名对外提供配置信息,方便维护.")]),s._v(" "),t("li",[s._v("甚至有的企业对解析至公网的域名有更高的要求(效率-ttl 更短,安全-dnssec)又不愿意付费,会选择自建公网 DNS")]),s._v(" "),t("li",[s._v("综上,需要构建至少一套企业内部的 DNS 服务")])]),s._v(" "),t("h2",{attrs:{id:"dns-软件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns-软件"}},[s._v("#")]),s._v(" DNS 软件")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("实现力 DNS 协议的开源免费的软件有很多,例如:powerdns,dnsmasq,bind 等")])]),s._v(" "),t("li",[t("p",[s._v("DNS 服务器的类型")]),s._v(" "),t("ul",[t("li",[s._v("主 DNS 服务器")]),s._v(" "),t("li",[s._v("辅助 DNS 服务器")]),s._v(" "),t("li",[s._v("缓存 DNS 服务器")])])]),s._v(" "),t("li",[t("p",[s._v("系统架构")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("内网 ip")]),s._v(" "),t("th",[s._v("主机名")]),s._v(" "),t("th",[s._v("功能")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("10.4.7.11")]),s._v(" "),t("td",[s._v("HDSS7-11.host.com")]),s._v(" "),t("td",[s._v("主 DNS 服务")])]),s._v(" "),t("tr",[t("td",[s._v("10.4.7.12")]),s._v(" "),t("td",[s._v("HDSS7-12.host.com")]),s._v(" "),t("td",[s._v("辅 DNS 服务")])])])])]),s._v(" "),t("li",[t("p",[s._v("软件版本")]),s._v(" "),t("ul",[t("li",[s._v("OS:CentOS7.6")]),s._v(" "),t("li",[s._v("Bind9:bind.X86_64")])])]),s._v(" "),t("li",[t("p",[s._v("docker 主机设置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5022")]),s._v(":22 --name centos --privileged"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true centos:7 /usr/sbin/init\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it centos /bin/bash\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" bind-utils net-tools\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])]),s._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[s._v("安装部署及配置详解")])]),s._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://blog.stanley.wang/2018/12/16/%E5%AE%9E%E9%AA%8C%E6%96%87%E6%A1%A31%EF%BC%9ABIND9%E7%9A%84%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/",target:"_blank",rel:"noopener noreferrer"}},[s._v("dns"),t("OutboundLink")],1)])]),s._v(" "),t("h1",{attrs:{id:"实验文档-1：bind9-的安装部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验文档-1：bind9-的安装部署"}},[s._v("#")]),s._v(" 实验文档 1：BIND9 的安装部署")]),s._v(" "),t("hr"),s._v(" "),t("h1",{attrs:{id:"安装部署-bind9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装部署-bind9"}},[s._v("#")]),s._v(" 安装部署 BIND9")]),s._v(" "),t("h2",{attrs:{id:"操作系统版本和内核版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作系统版本和内核版本"}},[s._v("#")]),s._v(" 操作系统版本和内核版本")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#cat /etc/redhat-release\nCentOS Linux release 7.6.1810 (Core)\n\n#uname -a\nLinux node 3.10.0-862.el7.x86_64 #1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"使用-yum-安装-bind9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-yum-安装-bind9"}},[s._v("#")]),s._v(" 使用 yum 安装 BIND9")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#yum install bind\n=============================================================================================================================================================\n Package                                       Arch                          Version                                    Repository                      Size\n=============================================================================================================================================================\nInstalling:\n bind                                          x86_64                        32:9.9.4-73.el7_6                          updates                        1.8 M\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("安装的版本为"),t("code",[s._v("9.9.4")])]),s._v(" "),t("h2",{attrs:{id:"bind9-主配置文件-etc-named-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#bind9-主配置文件-etc-named-conf"}},[s._v("#")]),s._v(" BIND9 主配置文件/etc/named.conf")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("主配置文件的格式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('options{\n     //全局选项\n}\nzone　"zone name" {\n   //定于区域\n}\nlogging{\n    //日志文件\n}\ninclude：加载别的文件\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("主配置文件的配置注意事项")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("语法严格，分号，空格")]),s._v(" "),t("li",[s._v("文件的权限，属主：root，属组：named，640")])])])]),s._v(" "),t("li",[t("p",[s._v("主配置文件范例")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('options {\n\tlisten-on port 53 { 10.4.7.11; };\n\tdirectory \t"/var/named";\n\tdump-file \t"/var/named/data/cache_dump.db";\n\tstatistics-file "/var/named/data/named_stats.txt";\n\tmemstatistics-file "/var/named/data/named_mem_stats.txt";\n\tallow-query     { any; };\n\n\t/*\n\t - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.\n\t - If you are building a RECURSIVE (caching) DNS server, you need to enable\n\t   recursion.\n\t - If your recursive DNS server has a public IP address, you MUST enable access\n\t   control to limit queries to your legitimate users. Failing to do so will\n\t   cause your server to become part of large scale DNS amplification\n\t   attacks. Implementing BCP38 within your network would greatly\n\t   reduce such attack surface\n\t*/\n\trecursion yes;\n\n\t\tdnssec-enable no;\n\t\tdnssec-validation no;\n\n\t/* Path to ISC DLV key */\n\tbindkeys-file "/etc/named.iscdlv.key";\n\n\tmanaged-keys-directory "/var/named/dynamic";\n\n\tpid-file "/run/named/named.pid";\n\tsession-keyfile "/run/named/session.key";\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])])])]),s._v(" "),t("p",[s._v('logging {\nchannel default_debug {\nfile "data/named.run";\nseverity dynamic;\n};\n};')]),s._v(" "),t("p",[s._v('zone "." IN {\ntype hint;\nfile "named.ca";\n};')]),s._v(" "),t("p",[s._v('include "/etc/named.rfc1912.zones";\ninclude "/etc/named.root.key";')]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n## BIND9 服务的启动\n\n### 检查配置文件\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h1",{attrs:{id:"named-checkconf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#named-checkconf"}},[s._v("#")]),s._v(" named-checkconf")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n没有报错就是正常的\n\n### 启动 BIND9 服务\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h1",{attrs:{id:"systemctl-start-named"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#systemctl-start-named"}},[s._v("#")]),s._v(" systemctl start named")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n### 检查 BIND9 服务状态\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h1",{attrs:{id:"systemctl-status-named"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#systemctl-status-named"}},[s._v("#")]),s._v(" systemctl status named")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n这样就完成了一个最基本的转发 DNS 的部署，它可以为我们的内网客户端提供 DNS 递归查询，例如查询并返回`www.baidu.com`的解析结果。\n\n## 验证解析\n\n### 配置 DNS 服务器指向\n\n在/etc/resole 里配置 DNS 服务器的 ip 地址为我们部署的主机 ip\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h1",{attrs:{id:"cat-etc-resolv-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cat-etc-resolv-conf"}},[s._v("#")]),s._v(" cat /etc/resolv.conf")]),s._v(" "),t("h1",{attrs:{id:"generated-by-networkmanager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#generated-by-networkmanager"}},[s._v("#")]),s._v(" Generated by NetworkManager")]),s._v(" "),t("p",[s._v("nameserver 10.4.7.11")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n### 验证解析\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h1",{attrs:{id:"ping-baidu-com"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ping-baidu-com"}},[s._v("#")]),s._v(" ping baidu.com")]),s._v(" "),t("p",[s._v("PING baidu.com (220.181.57.216) 56(84) bytes of data.")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\n## DNS 正解,反解配置详解\n\n- DNS 的自定义区域的配置(file 是区域数据库文件,allow-update 是 ip 列表或者 acl 访问控制)\n\n- ![image-20210325132307087](https://gitee.com/chobits01/image/raw/master/image/image-20210325132307087.png)\n\n- 区域数据库文件配置\n\n- ![image-20210325133340609](https://gitee.com/chobits01/image/raw/master/image/image-20210325133340609.png)\n\n- ![image-20210325134329489](https://gitee.com/chobits01/image/raw/master/image/image-20210325134329489.png)\n\n- 资源记录配置详解\n\n- ```shell\n  host.com.\t600\tIN SOA dns.host.com. riku7032.163.com. (\n  \t\t\t\t2019030301 ;serial number\n  \t\t\t\t10800      ;refresh time 3 hours\n  \t\t\t\t900        ;retry time 15 mins\n  \t\t\t\t604800     ;expire time 1 week\n  \t\t\t\t86400      ;negative answer ttl 1 day\n  )\n  host.com.\t600\tIN NS dns.host.com.\n\n  dns.host.com.\t60\tIN A 172.17.0.3\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("ul",[t("li",[t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" minutes\n@    IN SOA dns.host.com. riku7032.163.com. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019030301")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10800")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604800")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t    NS  dns.host.com.\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ORIGIN")]),s._v(" host.com.\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" minute\ndns     A "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.3\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])]),s._v(" "),t("h1",{attrs:{id:"实验文档-2：自定义正解域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验文档-2：自定义正解域"}},[s._v("#")]),s._v(" 实验文档 2：自定义正解域")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.stanley.wang/2018/12/16/%E5%AE%9E%E9%AA%8C%E6%96%87%E6%A1%A32%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%AD%A3%E8%A7%A3%E5%9F%9F/",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://s2.googleusercontent.com/s2/favicons?domain=blog.stanley.wang",alt:"img"}}),t("strong",[s._v("blog.stanley.wang")]),s._v("/2018/12/16/实验文档 2：自定义正解域"),t("OutboundLink")],1)]),s._v(" "),t("h1",{attrs:{id:"自定义区域配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义区域配置文件"}},[s._v("#")]),s._v(" 自定义区域配置文件")]),s._v(" "),t("p",[s._v("自定义区域的配置范例如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('zone "host.com" IN {\n        type  master;\n        file  "host.com.zone";\n        allow-update { 10.4.7.11;10.4.7.12; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("这里自定义了一个 host.com 的主机域，可以放在/etc/named.rfc1912.zones 文件中，也可以放置在自定义的文件中，在/etc/named.conf 里 include 进来")]),s._v(" "),t("blockquote",[t("p",[s._v("主机域")]),s._v(" "),t("ul",[t("li",[s._v("主机域和业务域无关，且建议分开")]),s._v(" "),t("li",[s._v("主机域其实是一个假域，也就是说，主机域其实是不能解析到互联网上的，它只对局域网（内网）提供服务")])])]),s._v(" "),t("h1",{attrs:{id:"自定义区域数据库文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义区域数据库文件"}},[s._v("#")]),s._v(" 自定义区域数据库文件")]),s._v(" "),t("ul",[t("li",[s._v("一般而言是文本文件，且只包含"),t("strong",[s._v("资源记录")]),s._v("、"),t("strong",[s._v("宏定义")]),s._v("和"),t("strong",[s._v("注释")])]),s._v(" "),t("li",[s._v("需在自定义区域配置文件中指定存放路径，可以绝对路径或相对路径（相对于/var/named 目录）")]),s._v(" "),t("li",[s._v("注意文件的属性（属主、属组及权限）")])]),s._v(" "),t("h2",{attrs:{id:"配置范例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置范例"}},[s._v("#")]),s._v(" 配置范例")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ORIGIN .\n$TTL 600\t; 10 minutes\nhost.com\t\t\tIN SOA\tns1.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121601 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900        ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\t\tNS   ns1.host.com.\n$ORIGIN host.com.\n$TTL 60\t; 1 minute\nns1                             A    10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h2",{attrs:{id:"资源记录（resource-record）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源记录（resource-record）"}},[s._v("#")]),s._v(" 资源记录（Resource Record）")]),s._v(" "),t("h3",{attrs:{id:"资源记录格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源记录格式"}},[s._v("#")]),s._v(" 资源记录格式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("name [ttl(缓存时间)] IN 资源记录类型（RRtype）  Value\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"常用资源记录类型（rr-type）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用资源记录类型（rr-type）"}},[s._v("#")]),s._v(" 常用资源记录类型（RR-type）")]),s._v(" "),t("h4",{attrs:{id:"soa-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#soa-记录"}},[s._v("#")]),s._v(" SOA 记录")]),s._v(" "),t("p",[s._v("SOA: 起始授权，只能有一条")]),s._v(" "),t("ul",[t("li",[s._v("name:只能是区域名称，通常可以简写为@，例如：od.com.")]),s._v(" "),t("li",[s._v("value:有 n 个数值，最主要的是主 DNS 服务器的 FQDN，点不可省略")])]),s._v(" "),t("p",[t("strong",[s._v("注意")]),s._v("：SOA 必须是区域数据库文件第一条记录")]),s._v(" "),t("blockquote",[t("p",[s._v("例子：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("@ 600 IN SOA  dns.host.com. 管理员邮箱（dnsadmin.host.com.）（\n     序列号(serial number) ;注释内容，十进制数据，不能超过10位，通常使用日期时间戳，例如2018121601\n     刷新时间(refresh time) ;即每隔多久到主服务器检查一次\n     重试时间(retry time) ;应该小于refresh time\n     过期时间(expire time);当辅助DNS服务器无法联系上主DNS服务器时，辅助DNS服务器可以在多长时间内认为其缓存是有效的，并供用户查询。\n     netgative answer ttl ;非权威应答的ttl，缓存DNS服务器可以缓存记录多长时间\n ）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"ns-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ns-记录"}},[s._v("#")]),s._v(" NS 记录")]),s._v(" "),t("p",[s._v("NS：可以有多条，每一个 NS 记录，"),t("strong",[s._v("必须")]),s._v("对应一个 A 记录")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("name:区域名称，通常可以简写为@")])]),s._v(" "),t("li",[t("p",[s._v("value:DNS 服务器的 FQDN(可以使用相对名称)")]),s._v(" "),t("blockquote",[t("p",[s._v("例子：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("@ 600 IN NS ns1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])]),s._v(" "),t("h4",{attrs:{id:"a-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#a-记录"}},[s._v("#")]),s._v(" A 记录")]),s._v(" "),t("p",[s._v("A：只能定义在正向区域数据库文件中（ipv4->FQDN）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("name:FQDN（可以使用相对名称)")])]),s._v(" "),t("li",[t("p",[s._v("value:IP")]),s._v(" "),t("blockquote",[t("p",[s._v("例子：(可以给一同一个域名通过轮询配置 2 个不同的 ip 地址)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("www  600(单位s) IN A 10.4.7.11\nwww  600(单位s) IN A 10.4.7.12\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])]),s._v(" "),t("p",[t("strong",[s._v("注")]),s._v(" 可以做轮询")]),s._v(" "),t("h4",{attrs:{id:"mx-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mx-记录"}},[s._v("#")]),s._v(" MX 记录")]),s._v(" "),t("p",[s._v("MX:邮件交换记录，可以有多个（用的不多）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("name:区域名称，用于标识 smtp 服务器")])]),s._v(" "),t("li",[t("p",[s._v("value:包含优先级和 FQDN")])]),s._v(" "),t("li",[t("p",[s._v("优先级:0-99，数字越小，级别越高，")]),s._v(" "),t("blockquote",[t("p",[s._v("例子：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("@ 600 IN MX 10 mail\n@ 600 IN MX 20 smtp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("h4",{attrs:{id:"cname-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cname-记录"}},[s._v("#")]),s._v(" CNAME 记录")]),s._v(" "),t("p",[s._v("CNAME：canonical name，别名（FQDN->FQDN）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("name ：FQDN")])]),s._v(" "),t("li",[t("p",[s._v("value :FQDN")]),s._v(" "),t("blockquote",[t("p",[s._v("例子：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("eshop IN CNAME www\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"宏定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#宏定义"}},[s._v("#")]),s._v(" 宏定义")]),s._v(" "),t("ul",[t("li",[s._v("$ORIGIN .")]),s._v(" "),t("li",[s._v("$TTL 60")])]),s._v(" "),t("h2",{attrs:{id:"注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注释"}},[s._v("#")]),s._v(" 注释")]),s._v(" "),t("p",[s._v("区域数据库文件中使用"),t("code",[s._v(";")]),s._v("（分号）来进行注释")]),s._v(" "),t("h1",{attrs:{id:"实战正解主机域配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战正解主机域配置"}},[s._v("#")]),s._v(" 实战正解主机域配置")]),s._v(" "),t("h2",{attrs:{id:"在-etc-named-rfc1912-zones-文件内最下，添加以下内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-etc-named-rfc1912-zones-文件内最下，添加以下内容"}},[s._v("#")]),s._v(" 在/etc/named.rfc1912.zones 文件内最下，添加以下内容")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('zone "host.com" IN {\n        type  master;\n        file  "host.com.zone";\n        allow-update { 10.4.7.11;10.4.7.12; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"在-var-named-下创建-host-com-zone-文件，写入以下内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-var-named-下创建-host-com-zone-文件，写入以下内容"}},[s._v("#")]),s._v(" 在/var/named 下创建 host.com.zone 文件，写入以下内容")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/host.com.zone\n$TTL 600\t; 10 minutes\n@       \t\tIN SOA\tdns.host.com. 87527941.qq.com. (\n\t\t\t\t2018121601 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900        ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\tNS   dns.host.com.\n$ORIGIN host.com.\n$TTL 60\t; 1 minute\nHDSS7-11 \t        A    10.4.7.11\ndns      \t        A    10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("三种配置方式：")]),s._v(" "),t("ul",[t("li",[s._v("用宏定义$ORIGIN . 下面用 host.com")]),s._v(" "),t("li",[s._v("不用宏定义，下面用@")]),s._v(" "),t("li",[s._v("不用宏定义，下面用 host.com.")])]),s._v(" "),t("h2",{attrs:{id:"检查配置并生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查配置并生效"}},[s._v("#")]),s._v(" 检查配置并生效")]),s._v(" "),t("h3",{attrs:{id:"检查自定义区域配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查自定义区域配置"}},[s._v("#")]),s._v(" 检查自定义区域配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#named-checkzone host.com. /var/named/host.com.zone\nzone host.com/IN: loaded serial 2018121601\nOK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"检查主配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查主配置文件"}},[s._v("#")]),s._v(" 检查主配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#named-checkconf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"重启-named-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启-named-服务"}},[s._v("#")]),s._v(" 重启 named 服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#systemctl restart named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"检查该正解域是否生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查该正解域是否生效"}},[s._v("#")]),s._v(" 检查该正解域是否生效")]),s._v(" "),t("p",[s._v("配置主机名")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# hostnamectl set-hostname hdss7-11.host.com\n# logout\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("开启第二台虚机，配置好 DNS 后验证解析")]),s._v(" "),t("h2",{attrs:{id:"维护正解域（增、删、改、查）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#维护正解域（增、删、改、查）"}},[s._v("#")]),s._v(" 维护正解域（增、删、改、查）")]),s._v(" "),t("h3",{attrs:{id:"增加一条资源记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加一条资源记录"}},[s._v("#")]),s._v(" 增加一条资源记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/host.com.zone\n$TTL 600\t; 10 minutes\n@       \t\tIN SOA\tdns.host.com. 87527941.qq.com. (\n\t\t\t\t2018121602 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900        ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\tNS   dns.host.com.\n$ORIGIN host.com.\n$TTL 60\t; 1 minute\nHDSS7-11 \t        A    10.4.7.11\nHDSS7-12 \t        A    10.4.7.12\ndns      \t        A    10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("增加一个 HDSS7-12.host.com 的 A 记录解析，并验证")]),s._v(" "),t("h3",{attrs:{id:"修改一条资源记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改一条资源记录"}},[s._v("#")]),s._v(" 修改一条资源记录")]),s._v(" "),t("p",[s._v("给"),t("code",[s._v("10.4.7.12")]),s._v("这台主机增加一个辅助 ip")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# ip addr add 10.4.7.13/24 dev eth0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改 DNS 服务器上的区域数据库文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/host.com.zone\n$TTL 600\t; 10 minutes\n@       \t\tIN SOA\tdns.host.com. 87527941.qq.com. (\n\t\t\t\t2018121603 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900        ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\tNS   dns.host.com.\n$ORIGIN host.com.\n$TTL 60\t; 1 minute\nHDSS7-11 \t        A    10.4.7.11\nHDSS7-12 \t        A    10.4.7.13\ndns      \t        A    10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("修改 HDSS7-12.host.com 的 A 记录解析，指向新增的辅助 ip"),t("code",[s._v("10.4.7.13")]),s._v("\n检查：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ping HDSS7-12.host.com\nING hdss7-12.host.com (10.4.7.13) 56(84) bytes of data.\n64 bytes from 10.4.7.13 (10.4.7.13): icmp_seq=1 ttl=64 time=0.318 ms\n64 bytes from 10.4.7.13 (10.4.7.13): icmp_seq=2 ttl=64 time=0.206 ms\n64 bytes from 10.4.7.13 (10.4.7.13): icmp_seq=3 ttl=64 time=0.391 ms\n^C\n--- hdss7-12.host.com ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2002ms\nrtt min/avg/max/mdev = 0.206/0.305/0.391/0.076 ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"删除一条资源记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除一条资源记录"}},[s._v("#")]),s._v(" 删除一条资源记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/host.com.zone\n$TTL 600\t; 10 minutes\n@       \t\tIN SOA\tns1.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121604 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900        ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\tNS   ns1.host.com.\n$ORIGIN host.com.\n$TTL 60\t; 1 minute\nns1      \t        A    10.4.7.11\nHDSS7-11 \t        A    10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("删除 HDSS7-12.host.com 的 A 记录解析，并验证")]),s._v(" "),t("h3",{attrs:{id:"查询记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询记录"}},[s._v("#")]),s._v(" 查询记录")]),s._v(" "),t("p",[s._v("略")]),s._v(" "),t("ul",[t("li",[s._v("DNS 的正向解析与反向解析")]),s._v(" "),t("li",[t("img",{attrs:{src:"https://gitee.com/chobits01/image/raw/master/image/image-20210325191034958.png",alt:"image-20210325191034958"}})])]),s._v(" "),t("h1",{attrs:{id:"实验文档-3：自定义反解域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验文档-3：自定义反解域"}},[s._v("#")]),s._v(" 实验文档 3：自定义反解域")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.stanley.wang/2018/12/16/%E5%AE%9E%E9%AA%8C%E6%96%87%E6%A1%A33%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%8D%E8%A7%A3%E5%9F%9F/",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://s2.googleusercontent.com/s2/favicons?domain=blog.stanley.wang",alt:"img"}}),t("strong",[s._v("blog.stanley.wang")]),s._v("/2018/12/16/实验文档 3：自定义反解域"),t("OutboundLink")],1)]),s._v(" "),t("blockquote"),s._v(" "),t("hr"),s._v(" "),t("h1",{attrs:{id:"添加反解域的自定义区域配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加反解域的自定义区域配置"}},[s._v("#")]),s._v(" 添加反解域的自定义区域配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/etc/named.rfc1912.zones\nzone "7.4.10.in-addr.arpa" IN {\n        type master;\n        file "7.4.10.in-addr.arpa.zone";\n        allow-update { 10.4.7.11;10.4.7.12; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h1",{attrs:{id:"添加反解域的区域数据库文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加反解域的区域数据库文件"}},[s._v("#")]),s._v(" 添加反解域的区域数据库文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/7.4.10.in-addr.arpa.zone\n$TTL 600\t; 10 minutes\n@\t     \t\tIN SOA\tdns.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121603 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900       ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\t    NS   ns1.host.com.\n$ORIGIN 7.4.10.in-addr.arpa.\n$TTL 60\t; 1 minute\n11\t\t\tPTR\t\t HDSS7-11.host.com.\n12\t\t\tPTR\t\t HDSS7-12.host.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("strong",[s._v("注意")]),s._v("：一个 IP 只能对应唯一的 FQDN 反解 PTR 记录，且应该与正解 A 记录对应")]),s._v(" "),t("h1",{attrs:{id:"检查反解域的配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查反解域的配置"}},[s._v("#")]),s._v(" 检查反解域的配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@hdss7-11 ~]# named-checkzone 7.4.10.in-addr.arpa /var/named/7.4.10.in-addr.arpa.zone\nzone 7.4.10.in-addr.arpa/IN: loaded serial 2018121603\nOK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h1",{attrs:{id:"重启-bind9-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启-bind9-服务"}},[s._v("#")]),s._v(" 重启 BIND9 服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@hdss7-11 ~]# systemctl restart named.service\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"检查解析是否生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查解析是否生效"}},[s._v("#")]),s._v(" 检查解析是否生效")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("方法 1：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@hdss7-11 ~]# dig -t PTR 11.7.4.10.in-addr.arpa. @10.4.7.11 +short\nHDSS7-11.host.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("方法 2：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@hdss7-11 ~]# dig -x 10.4.7.11 @10.4.7.11 +short\nHDSS7-11.host.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("h1",{attrs:{id:"增删改"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增删改"}},[s._v("#")]),s._v(" 增删改")]),s._v(" "),t("h2",{attrs:{id:"增加一条反解记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加一条反解记录"}},[s._v("#")]),s._v(" 增加一条反解记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/7.4.10.in-addr.arpa.zone\n$TTL 600\t; 10 minutes\n@\t     \t\tIN SOA\tdns.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121604 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900       ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\t    NS   ns1.host.com.\n$ORIGIN 7.4.10.in-addr.arpa.\n$TTL 60\t; 1 minute\n11\t\t\tPTR\t\t HDSS7-11.host.com.\n12\t\t\tPTR\t\t HDSS7-12.host.com.\n13\t\t\tPTR\t\t HDSS7-13.host.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"删除一条反解记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除一条反解记录"}},[s._v("#")]),s._v(" 删除一条反解记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/7.4.10.in-addr.arpa.zone\n$TTL 600\t; 10 minutes\n@\t     \t\tIN SOA\tdns.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121605 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900       ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\t    NS   ns1.host.com.\n$ORIGIN 7.4.10.in-addr.arpa.\n$TTL 60\t; 1 minute\n11\t\t\tPTR\t\t HDSS7-11.host.com.\n12\t\t\tPTR\t\t HDSS7-12.host.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h2",{attrs:{id:"修改一条反解记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改一条反解记录"}},[s._v("#")]),s._v(" 修改一条反解记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/7.4.10.in-addr.arpa.zone\n$TTL 600\t; 10 minutes\n@\t     \t\tIN SOA\tdns.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121606 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900       ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\t    NS   ns1.host.com.\n$ORIGIN 7.4.10.in-addr.arpa.\n$TTL 60\t; 1 minute\n11\t\t\tPTR\t\t HDSS7-11.host.com.\n12\t\t\tPTR\t\t HDSS7-13.host.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ul",[t("li",[s._v("DNS 服务生产维护经验")])]),s._v(" "),t("h1",{attrs:{id:"dns-主辅同步配置详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns-主辅同步配置详解"}},[s._v("#")]),s._v(" DNS 主辅同步配置详解")]),s._v(" "),t("ul",[t("li",[s._v("DNS 常用工具介绍")]),s._v(" "),t("li",[t("img",{attrs:{src:"https://gitee.com/chobits01/image/raw/master/image/image-20210325203938280.png",alt:"image-20210325203938280"}})])]),s._v(" "),t("h1",{attrs:{id:"实验文档-5：dns-工具和-rndc-远程管理-dns-实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验文档-5：dns-工具和-rndc-远程管理-dns-实战"}},[s._v("#")]),s._v(" 实验文档 5：DNS 工具和 rndc 远程管理 DNS 实战")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.stanley.wang/2018/12/16/%E5%AE%9E%E9%AA%8C%E6%96%87%E6%A1%A35%EF%BC%9ADNS%E5%B7%A5%E5%85%B7%E5%92%8Crndc%E8%BF%9C%E7%A8%8B%E7%AE%A1%E7%90%86DNS%E5%AE%9E%E6%88%98/",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://s2.googleusercontent.com/s2/favicons?domain=blog.stanley.wang",alt:"img"}}),t("strong",[s._v("blog.stanley.wang")]),s._v("/2018/12/16/实验文档 5：DNS 工具和 rndc 远程管理 DNS 实战"),t("OutboundLink")],1)]),s._v(" "),t("hr"),s._v(" "),t("h1",{attrs:{id:"dns-管理工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns-管理工具"}},[s._v("#")]),s._v(" DNS 管理工具")]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# yum install bind-utils -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"工具一：nslookup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具一：nslookup"}},[s._v("#")]),s._v(" 工具一：nslookup")]),s._v(" "),t("p",[s._v("Windows 操作系统也有的一个常用工具")]),s._v(" "),t("h3",{attrs:{id:"交互式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#交互式"}},[s._v("#")]),s._v(" 交互式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#nslookup\n> server localhost\nDefault server: localhost\nAddress: 127.0.0.1#53\nDefault server: localhost\nAddress: 127.0.0.1#53\n> www.bkjf-inc.com\nServer:\t\tlocalhost\nAddress:\t127.0.0.1#53\n\nName:\twww.bkjf-inc.com\nAddress: 192.144.198.128\n-------以上是权威应答\n> server 8.8.8.8\nDefault server: 8.8.8.8\nAddress: 8.8.8.8#53\n> www.bkjf-inc.com\nServer:\t\t8.8.8.8\nAddress:\t8.8.8.8#53\n\nNon-authoritative answer:\nName:\twww.bkjf-inc.com\nAddress: 192.144.198.128\n-------以上是非权威应答\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"非交互式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#非交互式"}},[s._v("#")]),s._v(" 非交互式")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#nslookup www.baidu.com\nServer:\t\t183.60.83.19\nAddress:\t183.60.83.19#53\n\nNon-authoritative answer:\nwww.baidu.com\tcanonical name = www.a.shifen.com.\nName:\twww.a.shifen.com\nAddress: 220.181.112.244\nName:\twww.a.shifen.com\nAddress: 220.181.111.37\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"工具二：host"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具二：host"}},[s._v("#")]),s._v(" 工具二：host")]),s._v(" "),t("p",[s._v("简单粗暴的小工具")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#host -t A www.baidu.com\nwww.baidu.com is an alias for www.a.shifen.com.\nwww.a.shifen.com has address 220.181.112.244\nwww.a.shifen.com has address 220.181.111.37\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"工具三：dig"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具三：dig"}},[s._v("#")]),s._v(" 工具三：dig")]),s._v(" "),t("p",[s._v("功能强大的 DNS 工具，重点掌握")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#dig -t A www.baidu.com @localhost\n\n; <<>> DiG 9.9.4-RedHat-9.9.4-73.el7_6 <<>> -t A www.baidu.com @localhost\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 46476\n;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 5, ADDITIONAL: 6\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;www.baidu.com.\t\t\tIN\tA\n\n;; ANSWER SECTION:\nwww.baidu.com.\t\t1200\tIN\tCNAME\twww.a.shifen.com.\nwww.a.shifen.com.\t300\tIN\tA\t220.181.111.37\nwww.a.shifen.com.\t300\tIN\tA\t220.181.112.244\n\n;; AUTHORITY SECTION:\na.shifen.com.\t\t1200\tIN\tNS\tns3.a.shifen.com.\na.shifen.com.\t\t1200\tIN\tNS\tns2.a.shifen.com.\na.shifen.com.\t\t1200\tIN\tNS\tns4.a.shifen.com.\na.shifen.com.\t\t1200\tIN\tNS\tns5.a.shifen.com.\na.shifen.com.\t\t1200\tIN\tNS\tns1.a.shifen.com.\n\n;; ADDITIONAL SECTION:\nns5.a.shifen.com.\t1200\tIN\tA\t180.76.76.95\nns1.a.shifen.com.\t1200\tIN\tA\t61.135.165.224\nns3.a.shifen.com.\t1200\tIN\tA\t112.80.255.253\nns4.a.shifen.com.\t1200\tIN\tA\t14.215.177.229\nns2.a.shifen.com.\t1200\tIN\tA\t220.181.57.142\n\n;; Query time: 561 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Fri Mar 01 09:45:51 CST 2019\n;; MSG SIZE  rcvd: 271\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("常用参数：")]),s._v(" "),t("ul",[t("li",[s._v("+[no]addition")]),s._v(" "),t("li",[s._v("+short")])]),s._v(" "),t("h2",{attrs:{id:"工具四：nsupdate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具四：nsupdate"}},[s._v("#")]),s._v(" 工具四：nsupdate")]),s._v(" "),t("p",[s._v("不常用，需要在 zone 配置文件里声明"),t("code",[s._v("allow-update { acl; };")])]),s._v(" "),t("h3",{attrs:{id:"调整-zone-配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调整-zone-配置文件"}},[s._v("#")]),s._v(" 调整 zone 配置文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/etc/named.rfc1912.zones\nzone "bkjf-inc.com" IN {\n        type master;\n        file "bkjf-inc.com.zone";\n        allow-update { 10.4.7.11/32; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("重启 named 服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl restart named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"新增一条记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新增一条记录"}},[s._v("#")]),s._v(" 新增一条记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#nsupdate\n> server 10.4.7.11\n> update add update.bkjf-inc.com 60 A 10.4.7.11\n> send\n> quit\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("检查：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#nslookup update.bkjf-inc.com\nServer:\t\t10.4.7.11\nAddress:\t10.4.7.11#53\n\nName:\tupdate.bkjf-inc.com\nAddress: 10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"查看区域数据库文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看区域数据库文件"}},[s._v("#")]),s._v(" 查看区域数据库文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/\n-rw-r--r-- 1 root  root   335 Feb 28 10:57 bkjf-inc.com.zone\n-rw-r--r-- 1 named named  733 Mar  1 09:54 bkjf-inc.com.zone.jnl\n#file bkjf-inc.com.zone.jnl\nbkjf-inc.com.zone.jnl: data\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("产生了一个 jnl 的数据文件，不能使用文本编辑器打开")]),s._v(" "),t("blockquote",[t("p",[s._v("jnl 文件（journal 文件）是 BIND9 动态更新的时候记录更新内容所生成的日志文件。")])]),s._v(" "),t("h3",{attrs:{id:"删除一条记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除一条记录"}},[s._v("#")]),s._v(" 删除一条记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#nsupdate\n> server 10.4.7.11\n> update delete update.bkjf-inc.com\n> send\n> quit\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("检查")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#nslookup update.bkjf-inc.com\nServer:\t\t10.4.7.11\nAddress:\t10.4.7.11#53\n\n** server can't find update.bkjf-inc.com: NXDOMAIN\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"更新一条记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新一条记录"}},[s._v("#")]),s._v(" 更新一条记录")]),s._v(" "),t("p",[s._v("不支持直接更新，需要先执行删除，再新增")]),s._v(" "),t("h3",{attrs:{id:"nsupdate-使用小结："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nsupdate-使用小结："}},[s._v("#")]),s._v(" nsupdate 使用小结：")]),s._v(" "),t("ul",[t("li",[s._v("优点\n"),t("ul",[t("li",[s._v("命令简单，便于记忆")]),s._v(" "),t("li",[s._v("不用手动变更 SOA 的 serial 序列号，自动滚动")]),s._v(" "),t("li",[s._v("不需要重启/重载 BIND9 服务/配置，生效快")]),s._v(" "),t("li",[s._v("可以通过配置 acl 实现远程管理")])])]),s._v(" "),t("li",[s._v("缺点\n"),t("ul",[t("li",[s._v("jnl 文件无法使用文本文件的方式打开")]),s._v(" "),t("li",[s._v("只能依赖完全区域传送查看所有区域的记录")]),s._v(" "),t("li",[s._v("更新操作复杂，先删再增")]),s._v(" "),t("li",[s._v("远程管理有安全隐患，需要加强审计")]),s._v(" "),t("li",[s._v("动态域在 rndc 管理上多一步")])])])]),s._v(" "),t("h1",{attrs:{id:"rndc-远程管理-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rndc-远程管理-dns"}},[s._v("#")]),s._v(" rndc 远程管理 DNS")]),s._v(" "),t("h2",{attrs:{id:"生成-rndc-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成-rndc-key"}},[s._v("#")]),s._v(" 生成 rndc-key")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#rndc-confgen -r /dev/urandom\n# Start of rndc.conf\nkey "rndc-key" {\n\talgorithm hmac-md5;\n\tsecret "MFM4AocpN0lcoL4fN2lA6Q==";\n};\n\noptions {\n\tdefault-key "rndc-key";\n\tdefault-server 127.0.0.1;\n\tdefault-port 953;\n};\n# End of rndc.conf\n\n# Use with the following in named.conf, adjusting the allow list as needed:\n# key "rndc-key" {\n# \talgorithm hmac-md5;\n# \tsecret "MFM4AocpN0lcoL4fN2lA6Q==";\n# };\n#\n# controls {\n# \tinet 127.0.0.1 port 953\n# \t\tallow { 127.0.0.1; } keys { "rndc-key"; };\n# };\n# End of named.conf\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h2",{attrs:{id:"把-rndc-key-和-controls-配置到-bind-的主配置文件的-options-段里"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#把-rndc-key-和-controls-配置到-bind-的主配置文件的-options-段里"}},[s._v("#")]),s._v(" 把 rndc-key 和 controls 配置到 bind 的主配置文件的 options 段里")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/etc/named.conf\nkey "rndc-key" {\n\talgorithm hmac-md5;\n\tsecret "MFM4AocpN0lcoL4fN2lA6Q==";\n};\n\ncontrols {\n      inet 10.4.7.11 port 953\n               allow { 10.4.7.11;10.4.7.12; } keys { "rndc-key"; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("**注意：**这里要配置一下 controls 段的 acl，限定好哪些主机可以使用 rndc 管理 DNS 服务")]),s._v(" "),t("h2",{attrs:{id:"重启-bind9-服务-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启-bind9-服务-2"}},[s._v("#")]),s._v(" 重启 bind9 服务")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# systemctl restart named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("rndc 的服务端监听在 953 端口，检查一下端口是否起来")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# netstat -luntp|grep 953\ntcp        0      0 10.4.7.11:953           0.0.0.0:*               LISTEN      11136/named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"在远程管理主机上安装-bind"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在远程管理主机上安装-bind"}},[s._v("#")]),s._v(" 在远程管理主机上安装 bind")]),s._v(" "),t("p",[s._v("rndc 命令在 bind 包里，所以远程管理主机需要安装 bind（不需要启动 named）")]),s._v(" "),t("h2",{attrs:{id:"在远程管理主机上做-rndc-conf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在远程管理主机上做-rndc-conf"}},[s._v("#")]),s._v(" 在远程管理主机上做 rndc.conf")]),s._v(" "),t("p",[s._v("使用 rndc 进行远程管理的主机上，都需要配置 rndc.conf，且 rndc-key 要和 DNS 服务器上的 key 一致")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/etc/rndc.conf\nkey "rndc-key" {\n\talgorithm hmac-md5;\n\tsecret "MFM4AocpN0lcoL4fN2lA6Q==";\n};\n\noptions {\n\tdefault-key "rndc-key";\n\tdefault-server 10.4.7.11;\n\tdefault-port 953;\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h2",{attrs:{id:"使用-rndc-命令远程管理-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-rndc-命令远程管理-dns"}},[s._v("#")]),s._v(" 使用 rndc 命令远程管理 DNS")]),s._v(" "),t("h3",{attrs:{id:"查询-dns-服务状态（可以取值做监控）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询-dns-服务状态（可以取值做监控）"}},[s._v("#")]),s._v(" 查询 DNS 服务状态（可以取值做监控）")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#rndc status\nversion: 9.9.4-RedHat-9.9.4-73.el7_6 <id:8f9657aa>\nCPUs found: 2\nworker threads: 2\nUDP listeners per interface: 2\nnumber of zones: 105\ndebug level: 0\nxfers running: 0\nxfers deferred: 0\nsoa queries in progress: 0\nquery logging is OFF\nrecursive clients: 0/0/1000\ntcp clients: 0/100\nserver is up and running\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"管理静态域-allow-update-none"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理静态域-allow-update-none"}},[s._v("#")]),s._v(" 管理静态域(allow-update { none; }😉")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('静态域zone文件\nzone "od.com" IN {\n\ttype master;\n\tfile "od.com.zone";\n\tallow-update { none; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("增、删、改一条记录后")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# rndc reload od.com\nzone reload up-to-date\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"管理动态域（allow-update-10-4-7-11-）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理动态域（allow-update-10-4-7-11-）"}},[s._v("#")]),s._v(" 管理动态域（allow-update { 10.4.7.11; };）")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('动态域zone文件\nzone "host.com" IN {\n\ttype master;\n\tfile "host.com.zone";\n\tallow-update { 10.4.7.11; };\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("增、删、改一条记录后")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#rndc reload host.com\nrndc: 'reload' failed: dynamic zone\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("直接 reload 会报错，需要先"),t("code",[s._v("freeze")]),s._v("再"),t("code",[s._v("thaw")]),s._v("才行")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#rndc freeze host.com\n#rndc thaw host.com\nThe zone reload and thaw was successful.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("主辅同步配置要点")]),s._v(" "),t("li",[t("img",{attrs:{src:"https://gitee.com/chobits01/image/raw/master/image/image-20210326084438164.png",alt:"image-20210326084438164"}})]),s._v(" "),t("li",[s._v("实战 DNS 主辅同步架构配置")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ORIGIN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" minutes\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".172.in-addr.arpa\tIN SOA\tdns.host.com. riku7032.163.com. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019030301")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" serial\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10800")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" refresh "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" hours"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" retry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" minutes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64800")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" expire "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" hours"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" minimum "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" day"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\tNS\tdns.host.com.\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ORIGIN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".172.in-addr.arpa.\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" minute\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\t\t\tPTR\thdss7-11.host.com.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\t\t\tPTR\thdss7-12.host.com.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\t\t\tPTR\thdss7-20.host.com.\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h1",{attrs:{id:"实验文档-4：dns-主辅同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验文档-4：dns-主辅同步"}},[s._v("#")]),s._v(" 实验文档 4：DNS 主辅同步")]),s._v(" "),t("h1",{attrs:{id:"dns-主辅同步架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dns-主辅同步架构"}},[s._v("#")]),s._v(" DNS 主辅同步架构")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("IP")]),s._v(" "),t("th",[s._v("主机名")]),s._v(" "),t("th",[s._v("功能")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("10.4.7.11")]),s._v(" "),t("td",[s._v("HDSS7-11.host.com")]),s._v(" "),t("td",[s._v("DNS 主")])]),s._v(" "),t("tr",[t("td",[s._v("10.4.7.12")]),s._v(" "),t("td",[s._v("HDSS7-12.host.com")]),s._v(" "),t("td",[s._v("DNS 辅")])]),s._v(" "),t("tr",[t("td",[t("strong",[s._v("注意")]),s._v("：所有资源记录的增、删、改的操作，均在主 DNS 上进行，辅助 DNS 仅提供查询功能")]),s._v(" "),t("td"),s._v(" "),t("td")])])]),s._v(" "),t("h1",{attrs:{id:"辅助-dns-主机上安装部署-bind9"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#辅助-dns-主机上安装部署-bind9"}},[s._v("#")]),s._v(" 辅助 DNS 主机上安装部署 BIND9")]),s._v(" "),t("h2",{attrs:{id:"安装-bind9-软件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-bind9-软件"}},[s._v("#")]),s._v(" 安装 BIND9 软件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("#yum install bind\n=============================================================================================================================================================\n Package                                       Arch                          Version                                    Repository                      Size\n=============================================================================================================================================================\nInstalling:\n bind                                          x86_64                        32:9.9.4-73.el7_6                          updates                        1.8 M\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("注意")]),s._v("：辅助 DNS 的 BIND9 软件版本应小于等于主 DNS 的 BIND9 软件版本")]),s._v(" "),t("h2",{attrs:{id:"修改辅助-dns-主配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改辅助-dns-主配置文件"}},[s._v("#")]),s._v(" 修改辅助 DNS 主配置文件")]),s._v(" "),t("p",[s._v("修改主配置文件，并加入"),t("code",[s._v("masterfile-format text;")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/etc/named.conf\noptions {\n  listen-on port 53 { 10.4.7.12; };\n  directory \t"/var/named";\n  dump-file \t"/var/named/data/cache_dump.db";\n  statistics-file "/var/named/data/named_stats.txt";\n  memstatistics-file "/var/named/data/named_mem_stats.txt";\n  allow-query     { any; };\n  masterfile-format text;\n  /*\n   - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.\n   - If you are building a RECURSIVE (caching) DNS server, you need to enable\n     recursion.\n   - If your recursive DNS server has a public IP address, you MUST enable access\n     control to limit queries to your legitimate users. Failing to do so will\n     cause your server to become part of large scale DNS amplification\n     attacks. Implementing BCP38 within your network would greatly\n     reduce such attack surface\n  */\n  recursion yes;\n\n  dnssec-enable no;\n  dnssec-validation no;\n\n  /* Path to ISC DLV key */\n  bindkeys-file "/etc/named.iscdlv.key";\n\n  managed-keys-directory "/var/named/dynamic";\n\n  pid-file "/run/named/named.pid";\n  session-keyfile "/run/named/session.key";\n};\n\n\nlogging {\n  channel default_debug {\n    file "data/named.run";\n    severity dynamic;\n  };\n};\n\nzone "." IN {\n  type hint;\n  file "named.ca";\n};\n\ninclude "/etc/named.rfc1912.zones";\ninclude "/etc/named.root.key";\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br")])]),t("h1",{attrs:{id:"修改主-dns-主配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改主-dns-主配置文件"}},[s._v("#")]),s._v(" 修改主 DNS 主配置文件")]),s._v(" "),t("h2",{attrs:{id:"加入以下配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加入以下配置"}},[s._v("#")]),s._v(" 加入以下配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/etc/named.conf\nallow-transfer { 10.4.7.12; };\nalso-notify { 10.4.7.12; };\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"检查配置并重启主-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查配置并重启主-dns"}},[s._v("#")]),s._v(" 检查配置并重启主 DNS")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# named-checkconf\n# systemctl restart named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"检查完全区域数据传送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查完全区域数据传送"}},[s._v("#")]),s._v(" 检查完全区域数据传送")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[root@hdss7-12 ~]# dig -t axfr host.com @10.4.7.11\n\n; <<>> DiG 9.9.4-RedHat-9.9.4-73.el7_6 <<>> -t axfr host.com @10.4.7.11\n;; global options: +cmd\nhost.com.\t\t600\tIN\tSOA\tdns.host.com. dnsadmin.host.com. 2018121601 10800 900 604800 86400\nhost.com.\t\t600\tIN\tNS\tns1.host.com.\nHDSS7-11.host.com.\t60\tIN\tA\t10.4.7.11\nHDSS7-12.host.com.\t60\tIN\tA\t10.4.7.12\nns1.host.com.\t\t60\tIN\tA\t10.4.7.11\nhost.com.\t\t600\tIN\tSOA\tdns.host.com. dnsadmin.host.com. 2018121601 10800 900 604800 86400\n;; Query time: 0 msec\n;; SERVER: 10.4.7.11#53(10.4.7.11)\n;; WHEN: Sun Dec 16 14:16:01 CST 2018\n;; XFR size: 6 records (messages 1, bytes 220)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h1",{attrs:{id:"辅助-dns-上创建自定义正解区域配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#辅助-dns-上创建自定义正解区域配置"}},[s._v("#")]),s._v(" 辅助 DNS 上创建自定义正解区域配置")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('/etc/named.rfc1912.zones\nzone "host.com" IN {\n  type  slave;\n  masters { 10.4.7.11; };\n  file  "slaves/host.com.zone";\n};\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h2",{attrs:{id:"检查配置并启动辅助-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查配置并启动辅助-dns"}},[s._v("#")]),s._v(" 检查配置并启动辅助 DNS")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# named-checkconf\n# systemctl start named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"检查同步过来的区域数据库文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查同步过来的区域数据库文件"}},[s._v("#")]),s._v(" 检查同步过来的区域数据库文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/var/named/slaves/host.com.zone\n[root@hdss7-12 slaves]# ll\n-rw-r--r-- 1 named named 392 Feb 10 21:08 host.com.zone\n[root@hdss7-12 slaves]# cat host.com.zone\n$ORIGIN .\n$TTL 600\t; 10 minutes\nhost.com\t\tIN SOA\tdns.host.com. dnsadmin.host.com. (\n\t\t\t\t2018121601 ; serial\n\t\t\t\t10800      ; refresh (3 hours)\n\t\t\t\t900        ; retry (15 minutes)\n\t\t\t\t604800     ; expire (1 week)\n\t\t\t\t86400      ; minimum (1 day)\n\t\t\t\t)\n\t\t\tNS\tns1.host.com.\n$ORIGIN host.com.\n$TTL 60\t; 1 minute\nHDSS7-11\t\tA\t10.4.7.11\nHDSS7-12\t\tA\t10.4.7.12\nns1\t\t\tA\t10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h2",{attrs:{id:"检查解析是否正确"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查解析是否正确"}},[s._v("#")]),s._v(" 检查解析是否正确")]),s._v(" "),t("h3",{attrs:{id:"使用主-dns-查询一个-a-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用主-dns-查询一个-a-记录"}},[s._v("#")]),s._v(" 使用主 DNS 查询一个 A 记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# dig -t A HDSS7-11.host.com @10.4.7.11 +short\n10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"使用辅助-dns-查询一个-a-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用辅助-dns-查询一个-a-记录"}},[s._v("#")]),s._v(" 使用辅助 DNS 查询一个 A 记录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# dig -t A HDSS7-11.host.com @10.4.7.12 +short\n10.4.7.11\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h1",{attrs:{id:"辅助-dns-上创建自定义反解区域配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#辅助-dns-上创建自定义反解区域配置"}},[s._v("#")]),s._v(" 辅助 DNS 上创建自定义反解区域配置")]),s._v(" "),t("p",[s._v("略")]),s._v(" "),t("h1",{attrs:{id:"增加、删除、修改记录，并验证同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加、删除、修改记录，并验证同步"}},[s._v("#")]),s._v(" 增加、删除、修改记录，并验证同步")]),s._v(" "),t("p",[t("strong",[s._v("注意")]),s._v("：一定要手动修改主 DNS 上 SOA 记录里的 serial 值！")]),s._v(" "),t("h2",{attrs:{id:"增加记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加记录"}},[s._v("#")]),s._v(" 增加记录")]),s._v(" "),t("h2",{attrs:{id:"删除记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除记录"}},[s._v("#")]),s._v(" 删除记录")]),s._v(" "),t("h2",{attrs:{id:"修改记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改记录"}},[s._v("#")]),s._v(" 修改记录")]),s._v(" "),t("h1",{attrs:{id:"再增加一个-od-com-的业务域，并验证主辅同步（复习）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#再增加一个-od-com-的业务域，并验证主辅同步（复习）"}},[s._v("#")]),s._v(" 再增加一个 od.com 的业务域，并验证主辅同步（复习）")]),s._v(" "),t("h2",{attrs:{id:"主-dns-上增加自定义区域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主-dns-上增加自定义区域"}},[s._v("#")]),s._v(" 主 DNS 上增加自定义区域")]),s._v(" "),t("h2",{attrs:{id:"主-dns-上增加自定义区域数据库文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主-dns-上增加自定义区域数据库文件"}},[s._v("#")]),s._v(" 主 DNS 上增加自定义区域数据库文件")]),s._v(" "),t("h2",{attrs:{id:"主-dns-上增加自定义区域资源记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主-dns-上增加自定义区域资源记录"}},[s._v("#")]),s._v(" 主 DNS 上增加自定义区域资源记录")]),s._v(" "),t("h2",{attrs:{id:"检查配置并重启主-dns-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查配置并重启主-dns-服务"}},[s._v("#")]),s._v(" 检查配置并重启主 DNS 服务")]),s._v(" "),t("h2",{attrs:{id:"辅助-dns-上增加自定义区域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#辅助-dns-上增加自定义区域"}},[s._v("#")]),s._v(" 辅助 DNS 上增加自定义区域")]),s._v(" "),t("h2",{attrs:{id:"检查完全区域数据传送-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查完全区域数据传送-2"}},[s._v("#")]),s._v(" 检查完全区域数据传送")]),s._v(" "),t("h2",{attrs:{id:"检查配置并重启辅助-dns-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查配置并重启辅助-dns-服务"}},[s._v("#")]),s._v(" 检查配置并重启辅助 DNS 服务")]),s._v(" "),t("h2",{attrs:{id:"验证主辅同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证主辅同步"}},[s._v("#")]),s._v(" 验证主辅同步")]),s._v(" "),t("h3",{attrs:{id:"分别使用主-dns-和辅助-dns-查询新业务域的-a-记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分别使用主-dns-和辅助-dns-查询新业务域的-a-记录"}},[s._v("#")]),s._v(" 分别使用主 DNS 和辅助 DNS 查询新业务域的 A 记录")]),s._v(" "),t("h3",{attrs:{id:"在主-dns-上新增一条-a-记录，并验证主辅同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在主-dns-上新增一条-a-记录，并验证主辅同步"}},[s._v("#")]),s._v(" 在主 DNS 上新增一条 A 记录，并验证主辅同步")]),s._v(" "),t("h3",{attrs:{id:"在主-dns-上修改一条-a-记录，并验证主辅同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在主-dns-上修改一条-a-记录，并验证主辅同步"}},[s._v("#")]),s._v(" 在主 DNS 上修改一条 A 记录，并验证主辅同步")]),s._v(" "),t("h3",{attrs:{id:"在主-dns-上删除一条-a-记录，并验证主辅同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在主-dns-上删除一条-a-记录，并验证主辅同步"}},[s._v("#")]),s._v(" 在主 DNS 上删除一条 A 记录，并验证主辅同步")]),s._v(" "),t("h3",{attrs:{id:"反解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反解"}},[s._v("#")]),s._v(" 反解")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("先增后删\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@HDSS7-12 slaves"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsupdate")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".172.in-addr.arpa "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" NS ns1.od.com.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".172.in-addr.arpa "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" NS ns2.od.com.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" send\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" quit\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@HDSS7-12 slaves"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsupdate")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" update del "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".172.in-addr.arpa. NS dns.host.com.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" send\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" quit\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" -t axfr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.17")]),s._v(".172.in-addr.arpa.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h1",{attrs:{id:"客户端配置-dns-解析高可用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置-dns-解析高可用"}},[s._v("#")]),s._v(" 客户端配置 DNS 解析高可用")]),s._v(" "),t("p",[s._v("在客户端主机（以 Linux 主机为例，Windows 和 Mac 操作系统略）配置主、辅 DNS")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/etc/resolv.conf\n#cat /etc/resolv.conf\n# Generated by NetworkManager\nsearch host.com od.com\nnameserver 10.4.7.11\nnameserver 10.4.7.12\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("这样客户端高可用就配置好了，任意一个 DNS 服务器宕机也不会影响正常解析")]),s._v(" "),t("ul",[t("li",[s._v("新增一个业务域,实现主辅同步")]),s._v(" "),t("li",[s._v("客户端配置 DNS 高可用")])])])}),[],!1,null,null,null);a.default=e.exports}}]);